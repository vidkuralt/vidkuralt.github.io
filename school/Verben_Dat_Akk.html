<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verben mit Pr√§positionen Trainer</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
    }

    h2 {
        text-align: center;
        color: white;
        font-size: 2.2em;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        animation: fadeInDown 0.6s ease;
    }

    .trainer-container {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        animation: fadeInUp 0.6s ease;
    }

    .toggle-container {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 30px;
        padding: 15px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .toggle-container:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    #modeToggle {
        width: 50px;
        height: 26px;
        appearance: none;
        background: #ccc;
        border-radius: 13px;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    #modeToggle:checked {
        background: #667eea;
    }

    #modeToggle::before {
        content: '';
        position: absolute;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: white;
        top: 2px;
        left: 2px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    #modeToggle:checked::before {
        left: 26px;
    }

    .toggle-container label {
        font-weight: 600;
        color: #333;
        cursor: pointer;
        user-select: none;
    }

    #verbDisplay {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 15px;
        border-left: 6px solid #667eea;
        animation: slideIn 0.5s ease;
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .input-group {
        margin-bottom: 15px;
    }

    input {
        padding: 15px 20px;
        width: 100%;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-size: 1.1em;
        transition: all 0.3s ease;
        background: #f8f9fa;
    }

    input:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    input::placeholder {
        color: #999;
    }

    .button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 25px;
    }

    button {
        padding: 15px 30px;
        border: none;
        border-radius: 12px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    button:first-child {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    button:first-child:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    button:first-child:active {
        transform: translateY(0);
    }

    button:last-child {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
    }

    button:last-child:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    #result {
        margin-top: 25px;
        padding: 20px;
        border-radius: 12px;
        font-size: 1.2em;
        font-weight: 600;
        text-align: center;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.5s ease;
    }

    .stats-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 25px;
    }

    #score {
        padding: 15px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 12px;
        font-weight: bold;
        font-size: 1.1em;
        text-align: center;
        color: #333;
    }

    #leftCount {
        padding: 15px;
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        border-radius: 12px;
        font-weight: 600;
        text-align: center;
        color: #2d3436;
        font-size: 0.95em;
    }

    #history {
        margin-top: 40px;
        animation: fadeIn 0.6s ease;
    }

    #history h3 {
        color: white;
        font-size: 1.8em;
        margin-bottom: 20px;
        text-align: center;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    #history button {
        margin-bottom: 20px;
        grid-column: span 2;
    }

    table {
        width: 100%;
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        text-align: center;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.9em;
        letter-spacing: 0.5px;
    }

    td {
        padding: 12px;
        text-align: center;
        border-bottom: 1px solid #f0f0f0;
        color: #333;
    }

    tr:last-child td {
        border-bottom: none;
    }

    tr:hover {
        background: #f8f9fa;
    }

    /* Animations */
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .correct-answer {
        background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
        color: white;
        animation: pulse 0.5s ease;
    }

    .wrong-answer {
        background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);
        color: white;
        animation: shake 0.5s ease;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }

    /* Responsive */
    @media (max-width: 600px) {
        h2 {
            font-size: 1.6em;
        }

        .trainer-container {
            padding: 25px;
        }

        #verbDisplay {
            font-size: 1.5em;
        }

        .button-group {
            grid-template-columns: 1fr;
        }

        .stats-container {
            grid-template-columns: 1fr;
        }

        th, td {
            padding: 8px;
            font-size: 0.85em;
        }
    }
</style>
</head>
<body>

<div class="container">
    <h2>üá©üá™ Verben mit Pr√§positionen ‚Äì Trainer</h2>

    <div class="trainer-container">
        <div class="toggle-container">
            <input type="checkbox" id="modeToggle" onchange="toggleMode()">
            <label for="modeToggle"><strong>Include Case (Dativ/Akkusativ)</strong></label>
        </div>

        <div id="verbDisplay">Lade...</div>

        <div class="input-group">
            <input id="prepInput" placeholder="Pr√§position (z. B. auf)" autocomplete="off">
        </div>

        <div class="input-group">
            <input id="caseInput" placeholder="Kasus (akk / dat)" style="display:none;" autocomplete="off">
        </div>

        <div class="button-group">
            <button onclick="checkAnswer()">√úberpr√ºfen</button>
            <button onclick="showHistory()">Ergebnisse anzeigen</button>
        </div>

        <div id="result"></div>

        <div class="stats-container">
            <div id="score">Score: ‚úÖ 0 | ‚ùå 0</div>
            <div id="leftCount">Verbleibende Artikel: 0</div>
        </div>
    </div>

    <div id="history"></div>
</div>

<script>
// ------------------- Database -----------------------
const verbs = { "abh√§ngen": [ { prep: "von", case: "dat" } ], "achten": [ { prep: "auf", case: "akk" } ], "anfangen": [ { prep: "mit", case: "dat" } ], "anrufen": [ { prep: "bei", case: "dat" } ], "antworten": [ { prep: "auf", case: "akk" } ], "arbeiten": [ { prep: "als", case: "nom" }, { prep: "bei", case: "dat" }, { prep: "an", case: "dat" } ], "sich √§rgern": [ { prep: "√ºber", case: "akk" } ], "aufh√∂ren": [ { prep: "mit", case: "dat" } ], "bedeuten": [ { prep: "f√ºr", case: "akk" } ], "sich beeilen": [ { prep: "mit", case: "dat" } ], "beginnen": [ { prep: "mit", case: "dat" } ], "berichten": [ { prep: "√ºber", case: "akk" }, { prep: "von", case: "dat" } ], "beschweren": [ { prep: "bei", case: "dat" }, { prep: "√ºber", case: "akk" } ], "bestehen": [ { prep: "aus", case: "dat" } ], "bitten": [ { prep: "um", case: "akk" } ], "danken": [ { prep: "f√ºr", case: "akk" } ], "demonstrieren": [ { prep: "f√ºr", case: "akk" }, { prep: "gegen", case: "akk"} ], "denken": [ { prep: "an", case: "akk" } ], "diskutieren": [ { prep: "√ºber", case: "akk" }, { prep: "mit", case: "dat" } ], "sich einigen": [ { prep: "auf", case: "akk" }, { prep: "mit", case: "dat" } ], "einladen": [ { prep: "zu", case: "dat" } ], "sich engagieren": [ { prep: "f√ºr", case: "akk" } ], "sich entscheiden": [ { prep: "f√ºr", case: "akk" }, { prep: "gegen", case: "akk" } ], "sich entschuldigen": [ { prep: "f√ºr", case: "akk" }, { prep: "bei", case: "dat" } ], "entstehen": [ { prep: "aus", case: "dat" } ], "sich erholen": [ { prep: "von", case: "dat" } ], "sich erinnern": [ { prep: "an", case: "akk" } ], "erwarten": [ { prep: "von", case: "dat" } ], "erz√§hlen": [ { prep: "von", case: "dat" } ], "sich freuen": [ { prep: "auf", case: "akk" }, { prep: "√ºber", case: "akk" } ], "fragen": [ { prep: "nach", case: "dat" } ], "es geht": [ { prep: "um", case: "akk" } ], "geh√∂ren": [ { prep: "zu", case: "dat" } ], "gelten": [ { prep: "als", case: "akk" } ], "sich gew√∂hnen": [ { prep: "an", case: "akk" } ], "glauben": [ { prep: "an", case: "akk" } ], "gratulieren": [ { prep: "zu", case: "dat" } ], "handeln": [ { prep: "von", case: "dat" }, { prep: "mit", case: "dat" } ], "helfen": [ { prep: "bei", case: "dat" }, { prep: "mit", case: "dat" } ], "teilnehmen": [ { prep: "an", case: "dat" } ], "sprechen": [ { prep: "√ºber", case: "akk" }, { prep: "mit", case: "dat" }, { prep: "von", case: "dat" } ], "sich informieren": [ { prep: "√ºber", case: "akk" } ], "sich interessieren": [ { prep: "f√ºr", case: "akk" } ], "k√§mpfen": [ { prep: "f√ºr", case: "akk" }, { prep: "gegen", case: "akk" }, { prep: "mit", case: "dat" }, { prep: "um", case: "akk" } ], "sich konzentrieren": [ { prep: "auf", case: "akk" } ], "sich k√ºmmern": [ { prep: "um", case: "akk" } ], "lachen": [ { prep: "√ºber", case: "akk" } ], "leiden": [ { prep: "an", case: "dat" }, { prep: "unter", case: "dat" } ], "lesen": [ { prep: "von", case: "dat" }, { prep: "√ºber", case: "akk" } ], "passen": [ { prep: "zu", case: "dat" } ], "protestieren": [ { prep: "gegen", case: "akk" } ], "reagieren": [ { prep: "auf", case: "akk" } ], "riechen": [ { prep: "nach", case: "dat" } ], "schicken": [ { prep: "an", case: "akk" } ], "schimpfen": [ { prep: "√ºber", case: "akk" }, { prep: "mit", case: "dat" } ], "sich spezialisieren": [ { prep: "auf", case: "akk" } ], "sterben": [ { prep: "an", case: "dat" } ], "steigen": [ { prep: "auf", case: "akk" } ], "sich streiten": [ { prep: "mit", case: "dat" }, { prep: "√ºber", case: "akk" } ], "suchen": [ { prep: "nach", case: "dat" } ], "tauschen": [ { prep: "gegen", case: "akk" } ], "telefonieren": [ { prep: "mit", case: "dat" } ], "tr√§umen": [ { prep: "von", case: "dat" } ], "sich treffen": [ { prep: "mit", case: "dat" } ], "√ºbersetzen": [ { prep: "in", case: "akk" }, { prep: "aus", case: "dat" } ], "√ºberzeugen": [ { prep: "von", case: "dat" } ], "sich unterhalten": [ { prep: "√ºber", case: "akk" }, { prep: "mit", case: "dat" } ], "sich verabreden": [ { prep: "mit", case: "dat" } ], "sich verlieben": [ { prep: "in", case: "akk" } ], "verzichten": [ { prep: "auf", case: "akk" } ], "sich vorbereiten": [ { prep: "auf", case: "akk" } ], "warnen": [ { prep: "vor", case: "dat" } ], "warten": [ { prep: "auf", case: "akk" } ], "sich wundern": [ { prep: "√ºber", case: "akk" } ], "zweifeln": [ { prep: "an", case: "dat" } ] };

// ------------------- Helper -----------------------
function normalize(text) {
  return String(text || "").toLowerCase()
             .replace(/√§/g, "a")
             .replace(/√∂/g, "o")
             .replace(/√º/g, "u")
             .replace(/√ü/g, "ss")
             .trim();
}

// ------------------- State -----------------------
let includeCase = false;
let correct = 0;
let wrong = 0;
let history = [];

// lists of question items (each verb-prep-case is one item)
let initialList = [];     // shuffled list of all items (initial pass)
let repeatList = [];      // items answered wrong to be repeated
let currentList = [];     // currently used list (initialList or repeatList)
let currentIndex = 0;     // index inside currentList
let currentItem = null;   // currently shown item

// ------------------- Build & shuffle questions -----------------------
function buildLists() {
  initialList = [];
  for (const verb of Object.keys(verbs)) {
    verbs[verb].forEach(entry => {
      initialList.push({ verb, prep: entry.prep, case: entry.case });
    });
  }
  // Fisher-Yates shuffle
  for (let i = initialList.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [initialList[i], initialList[j]] = [initialList[j], initialList[i]];
  }
  repeatList = [];
  currentList = initialList.slice();
  currentIndex = 0;
}

// ------------------- Helper: update counter -----------------------
function updateLeftCount() {
  const left = Math.max(0, currentList.length - currentIndex);
  document.getElementById("leftCount").textContent = `Verbleibende Artikel: ${left}`;
}

// ------------------- Mode toggle -----------------------
function toggleMode() {
  includeCase = document.getElementById("modeToggle").checked;
  document.getElementById("caseInput").style.display = includeCase ? "block" : "none";
  const resultEl = document.getElementById("result");
  resultEl.textContent = "";
  resultEl.className = "";
}

// ------------------- Start next round -----------------------
function newRound() {
  // If no more items in current list, attempt to switch to repeat list
  if (currentIndex >= currentList.length) {
    if (repeatList.length > 0) {
      // Start repeating mistakes in random order
      currentList = repeatList.slice();
      // shuffle repeat list
      for (let i = currentList.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentList[i], currentList[j]] = [currentList[j], currentList[i]];
      }
      repeatList = [];
      currentIndex = 0;
    } else {
      // Everything finished
      currentItem = null;
      document.getElementById("verbDisplay").textContent = "üéâ Alle Verben abgeschlossen!";
      updateLeftCount();
      return;
    }
  }

  currentItem = currentList[currentIndex];
  document.getElementById("verbDisplay").textContent = `${currentItem.verb}`;
  document.getElementById("prepInput").value = "";
  document.getElementById("caseInput").value = "";
  const resultEl = document.getElementById("result");
  resultEl.textContent = "";
  resultEl.className = "";
  updateScore();
  updateLeftCount();
}

// ------------------- Score -----------------------
function updateScore() {
  document.getElementById("score").textContent = `Score: ‚úÖ ${correct} | ‚ùå ${wrong}`;
}

// ------------------- Check Answer -----------------------
function checkAnswer() {
  if (!currentItem) return;

  const userPrep = normalize(document.getElementById("prepInput").value);
  const userCase = normalize(document.getElementById("caseInput").value);

  // Get all valid options for this verb
  const options = verbs[currentItem.verb];

  // Check if user input matches any valid option
  const isCorrect = options.some(opt => {
    const prepMatch = userPrep === normalize(opt.prep);
    const caseMatch = includeCase ? (userCase === normalize(opt.case)) : true;
    return prepMatch && caseMatch;
  });

  history.push({
    verb: currentItem.verb,
    yourPrep: userPrep || "(empty)",
    yourCase: includeCase ? (userCase || "(empty)") : "‚Äî",
    correctPrep: options.map(o => o.prep).join(" / "), // show all valid options
    correctCase: includeCase ? options.map(o => o.case).join(" / ") : "‚Äî",
    mode: includeCase ? "Prep + Case" : "Prep only",
    result: isCorrect ? "Correct" : "Wrong",
    timestamp: new Date().toISOString()
  });

  const resultEl = document.getElementById("result");

  if (isCorrect) {
    correct++;
    resultEl.textContent = "‚úÖ Richtig! Perfekt!";
    resultEl.className = "correct-answer";
  } else {
    wrong++;
    resultEl.textContent =
      `‚ùå Falsch! Richtig: "${options.map(o => o.prep + (includeCase ? ' + ' + o.case : '')).join(' / ')}"`;
    resultEl.className = "wrong-answer";

    // add to repeat list (avoid duplicates)
    const exists = repeatList.some(it =>
      it.verb === currentItem.verb && it.prep === currentItem.prep && it.case === currentItem.case
    );
    if (!exists) repeatList.push({ ...currentItem });
  }

  updateScore();

  currentIndex++;
  setTimeout(newRound, 1200);
}

// ------------------- Show history + CSV export -----------------------
function showHistory() {
  let html = "<h3>üìä Ergebnisse</h3>";
  html += `<div style="text-align: center; margin-bottom: 20px;"><button onclick="exportCSV()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: white; border: none; padding: 12px 30px; border-radius: 10px; cursor: pointer; font-weight: 600;">üì• Export CSV</button></div>`;
  html += "<table>";
  html += "<tr><th>Verb</th><th>Your Prep</th><th>Your Case</th><th>Correct Prep</th><th>Correct Case</th><th>Mode</th><th>Result</th></tr>";

  history.forEach(item => {
    html += `<tr>
      <td><strong>${item.verb}</strong></td>
      <td>${item.yourPrep}</td>
      <td>${item.yourCase}</td>
      <td>${item.correctPrep}</td>
      <td>${item.correctCase}</td>
      <td>${item.mode}</td>
      <td>${item.result === "Correct" ? "‚úÖ" : "‚ùå"}</td>
    </tr>`;
  });

  html += "</table>";
  document.getElementById("history").innerHTML = html;
}

// ------------------- CSV Export -----------------------
function exportCSV() {
  if (history.length === 0) {
    alert("Keine Ergebnisse zum Exportieren.");
    return;
  }

  const rows = [
    ["Verb", "Your Prep", "Your Case", "Correct Prep", "Correct Case", "Mode", "Result", "Timestamp"]
  ];

  history.forEach(h => {
    rows.push([h.verb, h.yourPrep, h.yourCase, h.correctPrep, h.correctCase, h.mode, h.result, h.timestamp]);
  });

  const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "verb_trainer_results.csv";
  a.style.display = "none";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// ------------------- Submit on Enter -----------------------
document.getElementById("prepInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") checkAnswer();
});
document.getElementById("caseInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") checkAnswer();
});

// ------------------- Start -----------------------
buildLists();
newRound();
</script>

</body>
</html>