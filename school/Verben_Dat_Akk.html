<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Verben mit Präpositionen Trainer</title>
<style>
    body { font-family: Arial; max-width: 700px; margin: 40px auto; }
    input { padding: 8px; width: 100%; margin-top: 5px; box-sizing: border-box; }
    button { padding: 10px; margin-top: 10px; width: 100%; cursor: pointer; }
    #result { margin-top: 20px; font-size: 1.2em; }
    #score { margin-top: 10px; font-weight: bold; }
    #history { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align:center; }
    .trainer-container { border: 1px solid #ccc; padding: 20px; border-radius: 8px; background: #f9f9f9; }
    .toggle-container { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
</style>
</head>
<body>

<h2>Verben mit Präpositionen – Trainer</h2>

<div class="trainer-container">
    <div class="toggle-container">
        <input type="checkbox" id="modeToggle" onchange="toggleMode()">
        <label for="modeToggle"><strong>Include Case (Dativ/Akkusativ)</strong></label>
    </div>

    <p id="verbDisplay"></p>

    <input id="prepInput" placeholder="Präposition (z. B. auf)">
    <input id="caseInput" placeholder="Kasus (akk / dat)" style="display:none;">

    <button onclick="checkAnswer()">Überprüfen</button>
    <button onclick="showHistory()">Show Results</button>

    <div id="result"></div>
    <div id="score"></div>
</div>

<div id="history"></div>

<script>
// ------------------- Database -----------------------
const verbs = {
  "abhängen": [ { prep: "von", case: "dat" } ],
  "arbeiten": [
    { prep: "als", case: "nom" },
    { prep: "bei", case: "dat" },
    { prep: "an", case: "dat" }
  ],
  "sich freuen": [ 
    { prep: "auf", case: "akk" },
    { prep: "über", case: "akk" }
  ]
  // Add more verbs as needed
};

// ------------------- Helper: remove umlauts -----------------------
function normalize(text) {
  return text.toLowerCase()
             .replace(/ä/g, "a")
             .replace(/ö/g, "o")
             .replace(/ü/g, "u")
             .replace(/ß/g, "ss")
             .trim();
}

// ------------------- Mode toggle -----------------------
let includeCase = false;
function toggleMode() {
  includeCase = document.getElementById("modeToggle").checked;
  document.getElementById("caseInput").style.display = includeCase ? "block" : "none";
  document.getElementById("result").textContent = "";
}

// ------------------- Training State -----------------------
let currentVerb = "";
let correct = 0;
let wrong = 0;
let history = [];

// ------------------- Get a random verb -----------------------
function getRandomVerb() {
  const keys = Object.keys(verbs);
  return keys[Math.floor(Math.random() * keys.length)];
}

// ------------------- Start new round -----------------------
function newRound() {
  currentVerb = getRandomVerb();
  document.getElementById("verbDisplay").textContent = `Verb: ${currentVerb}`;
  document.getElementById("result").textContent = "";
  document.getElementById("prepInput").value = "";
  document.getElementById("caseInput").value = "";
  updateScore();
}

// ------------------- Update score -----------------------
function updateScore() {
  document.getElementById("score").textContent = `Score: ✅ ${correct} | ❌ ${wrong}`;
}

// ------------------- Check Answer -----------------------
function checkAnswer() {
  const userPrep = normalize(document.getElementById("prepInput").value);
  const userCase = normalize(document.getElementById("caseInput").value);

  const correctEntries = verbs[currentVerb];
  let isCorrect = false;

  for (const entry of correctEntries) {
    const correctPrep = normalize(entry.prep);
    const correctCase = normalize(entry.case);
    if (includeCase) {
      if (userPrep === correctPrep && userCase === correctCase) { isCorrect = true; break; }
    } else {
      if (userPrep === correctPrep) { isCorrect = true; break; }
    }
  }

  history.push({
    verb: currentVerb,
    yourPrep: userPrep || "(empty)",
    yourCase: includeCase ? (userCase || "(empty)") : "—",
    correctPrep: correctEntries.map(e => e.prep).join(" / "),
    correctCase: includeCase ? correctEntries.map(e => e.case).join(" / ") : "—",
    result: isCorrect ? "Correct" : "Wrong",
    mode: includeCase ? "Prep + Case" : "Prep only"
  });

  if (isCorrect) {
    correct++;
    document.getElementById("result").textContent = "✅ Richtig!";
  } else {
    wrong++;
    document.getElementById("result").textContent =
      `❌ Falsch! Richtig: ${correctEntries.map(e => `"${e.prep}${includeCase ? ' + ' + e.case : ''}"`).join(" / ")}`;
  }

  updateScore();
  setTimeout(newRound, 1500);
}

// ------------------- Show History -----------------------
function showHistory() {
  let html = "<h3>Ergebnisse</h3>";
  html += "<table>";
  html += "<tr><th>Verb</th><th>Your Prep</th><th>Your Case</th><th>Correct Prep</th><th>Correct Case</th><th>Mode</th><th>Result</th></tr>";
  history.forEach(item => {
    html += `<tr>
      <td>${item.verb}</td>
      <td>${item.yourPrep}</td>
      <td>${item.yourCase}</td>
      <td>${item.correctPrep}</td>
      <td>${item.correctCase}</td>
      <td>${item.mode}</td>
      <td>${item.result === "Correct" ? "✅" : "❌"}</td>
    </tr>`;
  });
  html += "</table>";
  document.getElementById("history").innerHTML = html;
}

// ------------------- Submit on Enter -----------------------
document.getElementById("prepInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") checkAnswer();
});
document.getElementById("caseInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") checkAnswer();
});

// ------------------- Start -----------------------
newRound();
</script>

</body>
</html>
